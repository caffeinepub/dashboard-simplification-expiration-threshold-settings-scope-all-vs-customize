{
  "kind": "build_request",
  "title": "Fix entity saving for new values and refresh profile photo in binôme profile after update",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix profile saving so that the selected/updated profile picture (predefined avatar or custom upload) is not overwritten by a subsequent profile save, and ensure any UI that renders user avatars (including the “binôme profile” tab) reflects the new picture immediately after a successful save.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "La photo de profil de l'onglet binôme profile soit se MAJ une fois la photo choisie et enregistré."
        ]
      },
      "acceptanceCriteria": [
        "When a user selects a predefined avatar and clicks “Save Profile & Preferences”, the saved profile picture is the newly selected avatar (it must not revert to the previous avatar).",
        "When a user uploads a custom photo and clicks “Save Profile & Preferences”, the saved profile picture is the uploaded photo (it must not revert to the previous photo/avatar).",
        "After a successful save, any UI that displays the user’s avatar via public user info (e.g., the “binôme profile” tab) shows the updated avatar without requiring a hard refresh.",
        "React Query caches related to user profile/public user info are invalidated/refetched as needed so the update is visible immediately."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Allow saving a user profile entity value even when it is a newly typed entity (not present in suggestions), and ensure newly saved entities appear in entity suggestions thereafter. Support and validate examples including: \"T2I\", \"IVV\", \"Qualite\", \"IMI\", \"RLI\".",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "Le tag pour entity marche pas quand jen ajoute uk nouveau par exemple si je mets T2I, ca veut pas save et mets des exemples : e.g T2I, IVV, Qualite, IMI, RLI."
        ]
      },
      "acceptanceCriteria": [
        "Typing a new entity value (e.g., “T2I”) and saving the profile persists that entity on the backend and is shown when reloading the profile.",
        "Entity saving works regardless of whether the value came from suggestions or was newly typed.",
        "After saving a profile with a new entity value, the entity suggestions list includes the newly saved value (without requiring a full page reload).",
        "The backend does not reject profile saving for admin users due to email-domain rules when the frontend indicates admins can use any domain."
      ]
    }
  ],
  "constraints": [
    "Use English for any user-facing text.",
    "Backend must remain a single Motoko actor in backend/main.mo; add backend/migration.mo only if a state upgrade is required.",
    "Do not edit files under frontend/src/components/ui or other frontend immutable paths listed in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Adding new authentication providers (only Internet Identity is supported).",
    "Adding real-time features (e.g., websockets) for profile updates."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}